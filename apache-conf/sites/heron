# Apache configuration for heron site
# using JBoss for the administration tools
# and JBoss-via-php for i2b2

<VirtualHost *:80>
        ServerName heron.kumc.edu
	DocumentRoot "/usr/local/apache2/htdocs"

        <Directory /usr/local/apache2/htdocs/>
	     Order Deny,Allow
             Allow from All
        </Directory>

# Don't do this:
#    RedirectMatch permanent ^/$ https://raven.kumc.edu/
# See Rule - Do Not Perform Redirects from Non-TLS Page to TLS Login Page 
# https://www.owasp.org/index.php?title=Transport_Layer_Protection_Cheat_Sheet#Rule_-_Do_Not_Perform_Redirects_from_Non-TLS_Page_to_TLS_Login_Page

</VirtualHost>

Listen 443
<VirtualHost *:443>
        ServerName heron.kumc.edu

# robots.txt
        Alias /robots.txt /usr/local/apache2/htdocs/robots.txt

        <Directory /usr/local/apache2/htdocs/>
	     Order Deny,Allow
             Allow from All
        </Directory>

Include conf/apps/i2b2-webclient-cas

# connect to JBoss
        <Location /heron/>
         ProxyPass http://localhost:8080/heron-admin/
         ProxyPassReverse http://localhost:8080/heron-admin/
        </Location>

       
       RedirectMatch permanent ^/$ /heron/

	SSLEngine on

#~/apache-config/bmidev/mkcert$ make HOST=heron ssl-req
# ...
#~/apache-config/bmidev/mkcert$ ls -l heron-ssl-key.pem 
#-rw-r--r-- 1 dconnolly dconnolly 1679 2011-07-12 10:45 heron-ssl-key.pem
#~/apache-config/bmidev/mkcert$$ md5sum heron-ssl-key.pem 
#3ba0b71ed0673197834aee2f4ab8e7bb  heron-ssl-key.pem
	SSLCertificateKeyFile conf/heron-ssl-key.pem

#From:	sslorders@geotrust.com
#To: 	dconnolly@kumc.edu
#Cc: 	wanderson@kumc.edu
#Subject:	Subject: heron.kumc.edu RapidSSL Order: 7674617 Complete
#Date: 		Tue, 12 Jul 2011 17:12:22 +0000 (GMT) (07/12/2011 12:12:22 PM)
#
#Dear Dan Connolly,
#
# Congratulations! GeoTrust has approved your request for a RapidSSL
#	certificate. Your certificate is included at the end of this email.
	SSLCertificateFile    conf/heron-ssl-cert.pem

	BrowserMatch "MSIE [2-6]" 		nokeepalive ssl-unclean-shutdown 		downgrade-1.0 force-response-1.0
	# MSIE 7 and newer should be able to use keepalive
	BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

	ServerAdmin heron-admin@kumc.edu
</VirtualHost>
